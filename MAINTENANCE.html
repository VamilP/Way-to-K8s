<!DOCTYPE html><html><head>
      <title>MAINTENANCE</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\vamil\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="-cluster-maintenance--operations">ğŸ”§ Cluster Maintenance &amp; Operations </h1>
<blockquote>
<p><strong>Understanding Upgrades, Backups, High Availability, and Disaster Recovery</strong></p>
</blockquote>
<hr>
<h2 id="-learning-objectives">ğŸ¯ Learning Objectives </h2>
<p>By the end of this section, you will:</p>
<ul>
<li>Understand cluster upgrade strategies</li>
<li>Master node draining and cordoning</li>
<li>Perform etcd backups and restores</li>
<li>Configure high availability control plane</li>
<li>Understand disaster recovery procedures</li>
<li>Perform cluster maintenance safely</li>
</ul>
<hr>
<h2 id="ï¸-cluster-upgrades">â¬†ï¸ Cluster Upgrades </h2>
<h3 id="upgrade-strategy">Upgrade Strategy </h3>
<p><strong>Kubernetes supports:</strong></p>
<ul>
<li><strong>N-2 versions</strong> (current, N-1, N-2)</li>
<li><strong>Skips not allowed</strong> (must upgrade sequentially)</li>
</ul>
<p><strong>Example:</strong></p>
<ul>
<li>Current: v1.26</li>
<li>Can upgrade to: v1.27 or v1.28</li>
<li>Cannot skip to: v1.29</li>
</ul>
<h3 id="upgrade-process">Upgrade Process </h3>
<p><strong>Control Plane First:</strong></p>
<ol>
<li>Upgrade control plane nodes (one at a time)</li>
<li>Upgrade worker nodes</li>
<li>Verify cluster health</li>
</ol>
<p><strong>Steps:</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 1. Backup etcd</span>
<span class="token comment"># 2. Upgrade kubeadm</span>
<span class="token comment"># 3. Upgrade control plane</span>
kubeadm upgrade plan
kubeadm upgrade apply v1.28.0

<span class="token comment"># 4. Upgrade kubelet and kube-proxy</span>
<span class="token comment"># 5. Upgrade worker nodes (drain, upgrade, uncordon)</span>
</code></pre><h3 id="kubeadm-upgrade">kubeadm Upgrade </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Check upgrade plan</span>
kubeadm upgrade plan

<span class="token comment"># Upgrade control plane</span>
kubeadm upgrade apply v1.28.0

<span class="token comment"># Upgrade kubelet</span>
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> <span class="token assign-left variable">kubelet</span><span class="token operator">=</span><span class="token number">1.28</span>.0-00 <span class="token assign-left variable">kubeadm</span><span class="token operator">=</span><span class="token number">1.28</span>.0-00
systemctl daemon-reload
systemctl restart kubelet
</code></pre><hr>
<h2 id="-node-draining--cordoning">ğŸš« Node Draining &amp; Cordoning </h2>
<h3 id="cordon">Cordon </h3>
<p><strong>Purpose:</strong> Mark node as unschedulable.</p>
<p><strong>Effect:</strong></p>
<ul>
<li>New Pods won't schedule on node</li>
<li>Existing Pods continue running</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Cordon node</span>
kubectl cordon <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span>

<span class="token comment"># Verify</span>
kubectl get nodes
<span class="token comment"># Status: SchedulingDisabled</span>

<span class="token comment"># Uncordon node</span>
kubectl uncordon <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span>
</code></pre><h3 id="drain">Drain </h3>
<p><strong>Purpose:</strong> Evict Pods from node (for maintenance).</p>
<p><strong>Effect:</strong></p>
<ul>
<li>Marks node unschedulable</li>
<li>Evicts Pods (respects PDBs)</li>
<li>Pods rescheduled on other nodes</li>
</ul>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Drain node</span>
kubectl drain <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span> --ignore-daemonsets --delete-emptydir-data

<span class="token comment"># Options:</span>
<span class="token comment"># --ignore-daemonsets: Ignore DaemonSet Pods</span>
<span class="token comment"># --delete-emptydir-data: Delete emptyDir volumes</span>
<span class="token comment"># --force: Force drain even if Pods can't be evicted</span>
<span class="token comment"># --grace-period: Pod termination grace period</span>

<span class="token comment"># After maintenance, uncordon</span>
kubectl uncordon <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span>
</code></pre><h3 id="drain-workflow">Drain Workflow </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>1. Cordon node (mark unschedulable)
   â†“
2. Evict Pods (respect PDBs)
   â†“
3. Pods rescheduled on other nodes
   â†“
4. Perform maintenance
   â†“
5. Uncordon node (allow scheduling)
</code></pre><hr>
<h2 id="-etcd-backup--restore">ğŸ’¾ etcd Backup &amp; Restore </h2>
<h3 id="why-backup-etcd">Why Backup etcd? </h3>
<p><strong>etcd contains:</strong></p>
<ul>
<li>All cluster state</li>
<li>ConfigMaps, Secrets</li>
<li>Deployments, Pods</li>
<li>Services, Ingress</li>
<li><strong>Everything!</strong></li>
</ul>
<p><strong>If etcd is lost:</strong> Cluster state is lost.</p>
<h3 id="backup-etcd">Backup etcd </h3>
<p><strong>Method 1: Using etcdctl</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Set environment variables</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCDCTL_API</span><span class="token operator">=</span><span class="token number">3</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCDCTL_ENDPOINTS</span><span class="token operator">=</span>https://127.0.0.1:2379
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCDCTL_CACERT</span><span class="token operator">=</span>/etc/kubernetes/pki/etcd/ca.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCDCTL_CERT</span><span class="token operator">=</span>/etc/kubernetes/pki/etcd/server.crt
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ETCDCTL_KEY</span><span class="token operator">=</span>/etc/kubernetes/pki/etcd/server.key

<span class="token comment"># Create backup</span>
etcdctl snapshot save /backup/etcd-snapshot-<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span>.db

<span class="token comment"># Verify backup</span>
etcdctl snapshot status /backup/etcd-snapshot-20240101.db
</code></pre><p><strong>Method 2: Using kubeadm</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Backup etcd</span>
kubeadm backup-etcd --backup-dir<span class="token operator">=</span>/backup/etcd
</code></pre><h3 id="restore-etcd">Restore etcd </h3>
<p><strong>âš ï¸ Warning:</strong> Restore stops API server!</p>
<p><strong>Steps:</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># 1. Stop kube-apiserver</span>
<span class="token comment"># 2. Restore snapshot</span>
etcdctl snapshot restore /backup/etcd-snapshot.db <span class="token punctuation">\</span>
  --data-dir /var/lib/etcd-backup

<span class="token comment"># 3. Update etcd manifest to use new data-dir</span>
<span class="token comment"># 4. Start etcd</span>
<span class="token comment"># 5. Start kube-apiserver</span>
<span class="token comment"># 6. Verify cluster</span>
</code></pre><hr>
<h2 id="ï¸-high-availability-ha-control-plane">ğŸ—ï¸ High Availability (HA) Control Plane </h2>
<h3 id="why-ha">Why HA? </h3>
<p><strong>Single Control Plane Issues:</strong></p>
<ul>
<li>Single point of failure</li>
<li>Downtime during upgrades</li>
<li>No redundancy</li>
</ul>
<h3 id="ha-architecture">HA Architecture </h3>
<pre data-role="codeBlock" data-info="" class="language-text"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              HA CONTROL PLANE                         â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚ Master Node 1â”‚  â”‚ Master Node 2â”‚  â”‚ Master Node 3â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚  â”‚ API Server   â”‚  â”‚ API Server   â”‚  â”‚ API Server   â”‚
â”‚  â”‚ Scheduler    â”‚  â”‚ Scheduler    â”‚  â”‚ Scheduler    â”‚
â”‚  â”‚ Controller   â”‚  â”‚ Controller   â”‚  â”‚ Controller   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚         â”‚                 â”‚                 â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                             â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                  â”‚   etcd Cluster  â”‚                    â”‚
â”‚                  â”‚  (3 or 5 nodes) â”‚                    â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Worker Node 1â”‚  â”‚ Worker Node 2â”‚  â”‚ Worker Node 3â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><h3 id="ha-components">HA Components </h3>
<p><strong>API Server:</strong></p>
<ul>
<li>Multiple instances</li>
<li>Load balanced (external LB or kube-proxy)</li>
<li>Stateless (any instance can handle request)</li>
</ul>
<p><strong>etcd:</strong></p>
<ul>
<li>3 or 5 nodes (odd number for quorum)</li>
<li>Distributed consensus (Raft)</li>
<li>Quorum: (N/2) + 1</li>
</ul>
<p><strong>Scheduler/Controller:</strong></p>
<ul>
<li>Leader election</li>
<li>One active, others standby</li>
<li>Automatic failover</li>
</ul>
<h3 id="setting-up-ha">Setting Up HA </h3>
<p><strong>Using kubeadm:</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># First control plane node</span>
kubeadm init --control-plane-endpoint <span class="token operator">&lt;</span>load-balancer-ip<span class="token operator">&gt;</span>

<span class="token comment"># Additional control plane nodes</span>
kubeadm <span class="token function">join</span> <span class="token operator">&lt;</span>load-balancer-ip<span class="token operator">&gt;</span>:6443 <span class="token punctuation">\</span>
  <span class="token parameter variable">--token</span> <span class="token operator">&lt;</span>token<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --discovery-token-ca-cert-hash <span class="token operator">&lt;</span>hash<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  --control-plane <span class="token punctuation">\</span>
  --certificate-key <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span>
</code></pre><hr>
<h2 id="-disaster-recovery">ğŸš¨ Disaster Recovery </h2>
<h3 id="recovery-scenarios">Recovery Scenarios </h3>
<h4 id="scenario-1-etcd-data-loss">Scenario 1: etcd Data Loss </h4>
<p><strong>Symptoms:</strong></p>
<ul>
<li>API server can't read cluster state</li>
<li>Pods still running but can't be managed</li>
</ul>
<p><strong>Recovery:</strong></p>
<ol>
<li>Stop API server</li>
<li>Restore etcd from backup</li>
<li>Restart API server</li>
<li>Verify cluster state</li>
</ol>
<h4 id="scenario-2-control-plane-node-failure">Scenario 2: Control Plane Node Failure </h4>
<p><strong>Single Node:</strong></p>
<ul>
<li>If HA: Other nodes continue</li>
<li>If not HA: Cluster down</li>
</ul>
<p><strong>Recovery:</strong></p>
<ol>
<li>Replace failed node</li>
<li>Join new node to cluster</li>
<li>Restore etcd (if needed)</li>
</ol>
<h4 id="scenario-3-complete-cluster-loss">Scenario 3: Complete Cluster Loss </h4>
<p><strong>Recovery:</strong></p>
<ol>
<li>Provision new cluster</li>
<li>Restore etcd backup</li>
<li>Restore application manifests</li>
<li>Verify applications</li>
</ol>
<h3 id="disaster-recovery-plan">Disaster Recovery Plan </h3>
<p><strong>Preparation:</strong></p>
<ul>
<li>âœ… Regular etcd backups</li>
<li>âœ… Backup application manifests</li>
<li>âœ… Document cluster configuration</li>
<li>âœ… Test restore procedures</li>
</ul>
<p><strong>Backup Checklist:</strong></p>
<ul>
<li>etcd snapshots</li>
<li>Application YAMLs</li>
<li>ConfigMaps and Secrets</li>
<li>PersistentVolume data</li>
<li>Ingress configurations</li>
</ul>
<hr>
<h2 id="-rolling-updates--rollbacks">ğŸ”„ Rolling Updates &amp; Rollbacks </h2>
<h3 id="rolling-updates">Rolling Updates </h3>
<p><strong>Deployment Strategy:</strong></p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.22</span>
</code></pre><p><strong>Process:</strong></p>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Old Pods: [Pod-1] [Pod-2] [Pod-3]
           â†“
New Pod:  [Pod-4] (new image)
           â†“
Old Pods: [Pod-2] [Pod-3] [Pod-4]
           â†“
New Pod:  [Pod-5] (new image)
           â†“
Old Pods: [Pod-3] [Pod-4] [Pod-5]
           â†“
Complete: [Pod-4] [Pod-5] [Pod-6] (all new)
</code></pre><h3 id="rollback">Rollback </h3>
<p><strong>Rollback Deployment:</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Check rollout history</span>
kubectl rollout <span class="token function">history</span> deployment/nginx

<span class="token comment"># Rollback to previous version</span>
kubectl rollout undo deployment/nginx

<span class="token comment"># Rollback to specific revision</span>
kubectl rollout undo deployment/nginx --to-revision<span class="token operator">=</span><span class="token number">2</span>

<span class="token comment"># Check rollout status</span>
kubectl rollout status deployment/nginx
</code></pre><hr>
<h2 id="-hands-on-labs">ğŸ§ª Hands-On Labs </h2>
<h3 id="lab-1-cordon-and-drain-node">Lab 1: Cordon and Drain Node </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># List nodes</span>
kubectl get nodes

<span class="token comment"># Cordon node</span>
kubectl cordon <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span>

<span class="token comment"># Verify (should show SchedulingDisabled)</span>
kubectl get nodes

<span class="token comment"># Create Pod (won't schedule on cordoned node)</span>
kubectl run <span class="token builtin class-name">test</span> <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx

<span class="token comment"># Drain node</span>
kubectl drain <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span> --ignore-daemonsets --delete-emptydir-data

<span class="token comment"># Verify Pods evicted</span>
kubectl get pods <span class="token parameter variable">-o</span> wide

<span class="token comment"># Uncordon node</span>
kubectl uncordon <span class="token operator">&lt;</span>node-name<span class="token operator">&gt;</span>
</code></pre><h3 id="lab-2-rolling-update">Lab 2: Rolling Update </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Create Deployment</span>
kubectl create deployment nginx <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx:1.21

<span class="token comment"># Scale to 3 replicas</span>
kubectl scale deployment nginx <span class="token parameter variable">--replicas</span><span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># Update image</span>
kubectl <span class="token builtin class-name">set</span> image deployment/nginx <span class="token assign-left variable">nginx</span><span class="token operator">=</span>nginx:1.22

<span class="token comment"># Watch rollout</span>
kubectl rollout status deployment/nginx

<span class="token comment"># Check history</span>
kubectl rollout <span class="token function">history</span> deployment/nginx

<span class="token comment"># Rollback</span>
kubectl rollout undo deployment/nginx
</code></pre><h3 id="lab-3-check-cluster-health">Lab 3: Check Cluster Health </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token comment"># Check nodes</span>
kubectl get nodes

<span class="token comment"># Check component status</span>
kubectl get cs

<span class="token comment"># Check Pods in kube-system</span>
kubectl get pods <span class="token parameter variable">-n</span> kube-system

<span class="token comment"># Check cluster info</span>
kubectl cluster-info
</code></pre><hr>
<h2 id="-key-takeaways">ğŸ“ Key Takeaways </h2>
<ol>
<li><strong>Upgrades</strong> = Control plane first, then workers</li>
<li><strong>Cordon</strong> = Mark node unschedulable</li>
<li><strong>Drain</strong> = Evict Pods from node</li>
<li><strong>etcd backup</strong> = Critical for disaster recovery</li>
<li><strong>HA</strong> = Multiple control plane nodes</li>
<li><strong>etcd quorum</strong> = (N/2) + 1</li>
<li><strong>Rolling updates</strong> = Zero-downtime deployments</li>
<li><strong>Rollback</strong> = Revert to previous version</li>
<li><strong>Disaster recovery</strong> = Regular backups + tested procedures</li>
<li><strong>Maintenance</strong> = Plan, backup, drain, maintain, uncordon</li>
</ol>
<hr>
<h2 id="-next-steps">ğŸ”— Next Steps </h2>
<p>Now that you understand maintenance, let's build a <strong>Real-World Project</strong>:</p>
<p>ğŸ‘‰ <strong><a href="./PROJECT.md">Real-World Project</a></strong> - Production-like application deployment</p>
<hr>
<h2 id="-additional-resources">ğŸ“š Additional Resources </h2>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/">Upgrading kubeadm Clusters</a></li>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/">Backing up etcd</a></li>
<li><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/">High Availability</a></li>
</ul>
<hr>
<p><strong>Congratulations! You understand cluster maintenance. Ready for the real-world project? ğŸš€</strong></p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>